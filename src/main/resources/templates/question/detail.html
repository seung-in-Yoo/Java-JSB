<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8" />
    <title th:text="${question.title}">질문 상세</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        :root{
            --bg:#fafafa; --card:#fff; --text:#111; --muted:#6b7280; --line:#e5e7eb;
            --brand:#413D3D; --brand-weak:#ebe9e9; --shadow:0 8px 24px rgba(0,0,0,.06);
            --radius:14px;
        }
        @media (prefers-color-scheme: dark){
            :root{ --bg:#0b0c0f; --card:#13151a; --text:#e8e9ee; --muted:#9aa0ab; --line:#2a2e37; --brand-weak:#2a2323; --shadow:0 8px 30px rgba(0,0,0,.45); }
            a{ color:inherit }
        }

        *{box-sizing:border-box}
        body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif;
            margin:0;background:var(--bg);color:var(--text);line-height:1.55}
        a{color:inherit;text-decoration:none}
        a:hover{text-decoration:underline}
        a:visited{color:inherit}

        .container{max-width:880px;margin:auto;padding:24px 18px}
        .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);
            box-shadow:var(--shadow)}

        /* Top nav back */
        .back-link{
            display:inline-flex;align-items:center;gap:10px;
            padding:10px 14px;border:1px solid var(--line);border-radius:12px;
            background:var(--card);font-weight:600;box-shadow:var(--shadow)
        }
        .back-link svg{width:18px;height:18px}
        .back-link:hover{text-decoration:none;transform:translateY(-1px)}

        /* Header */
        h1{margin:16px 0 10px;font-size:28px;letter-spacing:-.3px}
        .meta{font-size:13px;color:var(--muted);display:flex;gap:12px;flex-wrap:wrap}
        .meta > span+span{position:relative;padding-left:12px}
        .meta > span+span::before{content:"·";position:absolute;left:2px;top:0;color:var(--muted)}
        .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;
            background:var(--brand-weak);color:var(--text);border:1px solid var(--line);font-weight:600}

        .section{margin-top:20px}
        .content{margin-top:16px;font-size:16px}
        .content p{margin:0 0 14px}
        .divider{height:1px;background:var(--line);margin:22px 0}

        /* Buttons */
        .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;
            border:1px solid var(--line);background:var(--card);text-decoration:none}
        .btn:hover{text-decoration:none;transform:translateY(-1px)}
        .btn.primary{background:var(--brand);color:#fff;border-color:var(--brand)}
        .btn.danger{background:#c0392b;color:#fff;border-color:#c0392b}

        /* Answers */
        .ans{padding:18px;border:1px solid var(--line);border-radius:12px;background:var(--card);margin-top:12px}
        .ans .meta{margin-bottom:8px}
        .editor textarea{width:100%;border:1px solid var(--line);border-radius:12px;padding:12px;
            background:var(--card);color:var(--text)}

    </style>
</head>
<body>
<div class="container">

    <a th:href="@{/questions}" class="back-link" aria-label="목록으로 돌아가기">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M15 18l-6-6 6-6"/>
        </svg>
        <span>목록</span>
    </a>

    <article class="section card" style="padding:22px;">
        <h1 th:text="${question.title}">제목</h1>
        <div class="meta">
            <span class="chip" th:text="${question.categoryName}">카테고리</span>
            <span th:text="${question.author.name}">작성자</span>
            <span th:text="${#temporals.format(question.createdAt,'yyyy.MM.dd HH:mm')}">작성일</span>
            <span th:text="|조회 ${question.viewCount}|">조회 0</span>
        </div>

        <div class="content" th:utext="${question.contentHtml}">본문</div>

        <div class="divider"></div>

        <!-- 작성자일 때만 보이는 영역 -->
        <div th:if="${isQuestionAuthor}" style="display:flex; gap:8px;">
            <a class="btn" th:href="@{|/questions/${question.id}/edit|}">수정</a>

            <form th:action="@{|/questions/${question.id}|}"
                  method="post" onsubmit="return confirm('정말 삭제하시겠어요? 삭제 후에는 되돌릴 수 없습니다.');">
                <input type="hidden" name="_method" value="delete" />
                <button class="btn danger" type="submit">삭제</button>
            </form>
        </div>
    </article>

    <section class="section">
        <h2 th:text="|답변 ${#lists.size(answers)}|">답변 0</h2>

        <div th:each="a : ${answers}" class="ans">
            <div class="meta">
                <span th:text="${a.authorName}">작성자</span>
                <span th:text="${#temporals.format(a.createdAt,'yyyy.MM.dd HH:mm')}">날짜</span>
            </div>
            <div class="content" th:utext="${a.contentHtml}">답변 내용</div>
        </div>
    </section>

    <section class="section card editor" th:if="${isLoggedIn}" style="padding:18px;">
        <h3>답변 작성</h3>
        <form th:action="@{|/questions/${question.id}/answers|}" method="post">
            <textarea name="content" rows="8" placeholder="답변 내용을 입력하세요"></textarea>
            <div style="margin-top:12px;display:flex;gap:8px;">
                <button class="btn primary" type="submit">등록</button>
            </div>
        </form>
    </section>

    <section class="section" th:if="${!isLoggedIn}">
        <a class="btn" th:href="@{/login}">로그인 후 답변을 작성할 수 있어요</a>
    </section>

</div>
</body>
</html>
